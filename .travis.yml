sudo: false
language: python

jobs:
  include:
      - &test
        stage: test
        services: mongodb
        before_script:
          - sleep 15
          - mongo orion_test --eval 'db.createUser({user:"user",pwd:"pass",roles:["readWrite"]});'
        env: TOXENV=py36
        python: 3.6
      - <<: *test
        env: TOXENV=py37
        python: 3.7
        dist: bionic
        sudo: true
      - stage: packaging
        env: TOXENV=packaging
        python: 3.6

install:
  - pip install tox codecov
script:
  - tox
after_success:
  - codecov

# deploy:
#   skip_cleanup: true
#   provider: pypi
#   user: "..."
#   password:
#     secure: "..."
#   on:
#     branch: master
#   distributions: "sdist bdist_wheel"
