name: Test Dashboard build

on:
  pull_request:
    branches:
      - develop
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: |
          python -m pip install --upgrade pip
          pip install -e .[test]
    - name: Get gecko driver
      run: |
          wget https://github.com/mozilla/geckodriver/releases/download/v0.31.0/geckodriver-v0.31.0-linux64.tar.gz
          tar -xvf geckodriver-v0.31.0-linux64.tar.gz
          export PATH=$PATH:$(pwd)
    - name: Launch backend
      run: orion serve -c .github/workflows/orion/orion_config.yaml &
    - name: Launch frontend
      run: orion frontend &
    - name: Test frontend
      run: python tests/functional/serving/check_frontend.py
